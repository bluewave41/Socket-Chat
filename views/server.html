<h1>Socket Chat</h1>
<div id="content">
</div>

<script>
	socket.off('users');
	socket.emit('getUsers', '');
	socket.on('users', function(data) {
		console.log(data);
		let content = $('#content');
		for(var x=0;x<data.length;x++) {
			let $div = $('<div class="user"></div>');
			let $input = $(`<textarea id=${data[x]}></textarea>`);
			if(data[x] == id) {
				$input.keyup(function() {
					socket.emit('updateText', [id, $(this).val()]);
				});
				$div.append('<div id="optionsContent"><label>Command: </label><input  id="optionsText" type="text"></input>');
				$div.append('<div id="options">OPTIONS</div></div>');
			}
			else
				$input.prop('disabled', true);
			content.append($div.prepend($input));
		}
	});
	socket.on('receiveUser', function(id) {
		$('#content').append(`<textarea id=${id} disabled></textarea>`);
	});
	socket.on('userLeft', function(id) {
		$('#'+id).remove();
	});
	socket.on('updateText', function(userObject) {
		$('#' + userObject[0]).val(userObject[1]);
	});
	socket.on('updateColor', function(colorObject) {
		console.log(colorObject);
		$('#' + colorObject[0]).css({color: colorObject[1]});
	});
	
	$('#content').on('click', '#options', function() {
		$('#optionsContent').slideToggle();
	});
	$('#content').on('keypress', '#optionsText', function(e) {
		console.log($(this).val());
		if(e.keyCode == 13) {
			socket.emit('options', $(this).val());
			$(this).val('');
		}
	});
</script>